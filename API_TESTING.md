# Google Places API 実動作確認ガイド

このドキュメントでは、デモデータではなく実際のGoogle Places APIを使用してアプリケーションの動作を確認する方法を説明します。

## 🔧 事前準備

### 1. Google Cloud Platform の設定

1. **Google Cloud Console にアクセス**
   - [Google Cloud Console](https://console.cloud.google.com/) にログイン
   - プロジェクトを作成または選択

2. **必要なAPIを有効化**
   ```
   APIとサービス → ライブラリ から以下を有効化：
   - Places API (必須)
   - Maps JavaScript API (オプション)
   ```

3. **APIキーを作成**
   ```
   APIとサービス → 認証情報 → 認証情報を作成 → APIキー
   ```

4. **APIキーの制限設定（推奨）**
   ```
   アプリケーションの制限: HTTPリファラー
   許可するリファラー:
   - http://localhost:3000/*
   - https://your-domain.vercel.app/*
   
   APIの制限: Places API
   ```

### 2. 環境変数の設定

1. **APIキーを環境変数に設定**
   ```bash
   # .env.local ファイルを編集
   GOOGLE_MAPS_API_KEY=your_actual_api_key_here
   ```

## 🧪 API動作確認

### 1. APIテストスクリプトの実行

```bash
# Google Places API の動作確認
npm run test:api
```

このスクリプトは以下をテストします：
- ✅ APIキーの有効性
- ✅ Nearby Search API の動作
- ✅ Place Details API の動作
- ✅ レスポンスデータの形式

### 2. 期待される出力例

```
🚀 Google Places API 動作確認を開始します...
📍 テスト位置: 東京駅周辺 (35.6812, 139.7671)

🔍 Nearby Search API をテスト中...
📊 API Response Status: OK
✅ Nearby Search API: 成功
📍 見つかったレストラン数: 20

📋 最初のレストラン情報:
   名前: 東京ステーションホテル レストラン
   評価: 4.2
   住所: 東京都千代田区丸の内1丁目
   Place ID: ChIJ...

🔍 Place Details API をテスト中...
📊 API Response Status: OK
✅ Place Details API: 成功

📋 詳細情報:
   名前: 東京ステーションホテル レストラン
   評価: 4.2
   住所: 東京都千代田区丸の内1丁目9-1
   電話番号: 03-5220-1111
   ウェブサイト: https://www.tokyostationhotel.jp/
   価格帯: 4
   営業状況: 営業中
   営業時間:
     月曜日: 11:30～14:30, 17:30～21:30
     火曜日: 11:30～14:30, 17:30～21:30
     ...
   レビュー数: 5
   最新レビュー:
     評価: 5/5
     投稿者: 田中太郎
     内容: 素晴らしいサービスと美味しい料理でした...

✨ テスト完了
🎉 Google Places API は正常に動作しています！
💡 アプリケーションで実際のデータを使用できます
```

## 🚀 アプリケーションでの実動作確認

### 1. 開発サーバーの起動

```bash
npm run dev
```

### 2. 実際のデータでの動作確認

1. **レストラン検索**
   - ブラウザで http://localhost:3000 を開く
   - 「現在地を取得」をクリック
   - 位置情報を許可
   - **実際のレストランデータ**が表示されることを確認

2. **詳細ページの確認**
   - レストランカードの「詳細を見る」をクリック
   - 以下の実際のデータが表示されることを確認：
     - ✅ 実際のレストラン名
     - ✅ 実際の評価・レビュー
     - ✅ 実際の住所・電話番号
     - ✅ 実際の営業時間
     - ✅ 実際のウェブサイトリンク

### 3. デモデータとの比較

| 項目 | デモデータ | 実際のAPIデータ |
|------|-----------|----------------|
| レストラン名 | 固定の3件 | 現在地周辺の実際のレストラン |
| 評価 | 固定値 | 実際のGoogle評価 |
| レビュー | 固定のサンプル | 実際のユーザーレビュー |
| 営業時間 | 固定のサンプル | 実際の営業時間 |
| 電話番号 | 固定のサンプル | 実際の電話番号 |
| ウェブサイト | 固定のサンプル | 実際のウェブサイト |

## ❌ トラブルシューティング

### よくあるエラーと対処法

#### 1. `REQUEST_DENIED` エラー
```
❌ API Response Status: REQUEST_DENIED
```
**対処法:**
- APIキーが正しく設定されているか確認
- Places API が有効化されているか確認
- APIキーの制限設定を確認

#### 2. `OVER_QUERY_LIMIT` エラー
```
❌ API Response Status: OVER_QUERY_LIMIT
```
**対処法:**
- API利用制限に達しています
- しばらく時間をおいてから再試行
- Google Cloud Console で利用状況を確認

#### 3. `ZERO_RESULTS` エラー
```
❌ API Response Status: ZERO_RESULTS
```
**対処法:**
- 検索範囲を広げる（radius を増加）
- 検索位置を変更する
- 検索タイプを変更する（restaurant → food）

#### 4. ネットワークエラー
```
❌ ネットワークエラー: fetch failed
```
**対処法:**
- インターネット接続を確認
- ファイアウォール設定を確認
- プロキシ設定を確認

## 📊 API利用状況の監視

### Google Cloud Console での確認

1. **API利用状況**
   ```
   APIとサービス → ダッシュボード
   ```

2. **利用制限の確認**
   ```
   APIとサービス → 割り当て
   ```

3. **課金状況の確認**
   ```
   お支払い → 概要
   ```

### 推奨設定

- **1日あたりのリクエスト制限**: 1,000回
- **1分あたりのリクエスト制限**: 100回
- **アラート設定**: 利用量が80%に達したら通知

## 🎯 本番環境での確認

### Vercel での環境変数設定

1. **Vercel Dashboard**
   ```
   プロジェクト → Settings → Environment Variables
   ```

2. **環境変数の追加**
   ```
   Name: GOOGLE_MAPS_API_KEY
   Value: your_actual_api_key_here
   Environments: ✅ Production ✅ Preview ✅ Development
   ```

3. **デプロイ後の確認**
   - 本番URLでアプリケーションにアクセス
   - 実際のレストランデータが表示されることを確認
   - 詳細ページで実際のデータが表示されることを確認

## ✅ 確認チェックリスト

- [ ] Google Cloud Platform でAPIが有効化されている
- [ ] APIキーが正しく設定されている
- [ ] APIキーの制限設定が適切である
- [ ] `npm run test:api` が成功する
- [ ] ローカル環境で実際のデータが表示される
- [ ] 詳細ページで実際のデータが表示される
- [ ] 本番環境で実際のデータが表示される
- [ ] API利用状況が監視されている

## 💡 最適化のヒント

1. **キャッシュの活用**
   - 同じ場所の検索結果をキャッシュ
   - 詳細情報のキャッシュ

2. **リクエストの最適化**
   - 必要なフィールドのみ取得
   - 適切な検索範囲の設定

3. **エラーハンドリング**
   - 適切なフォールバック処理
   - ユーザーフレンドリーなエラーメッセージ

4. **コスト管理**
   - API利用量の監視
   - 適切な制限設定
   - 不要なリクエストの削減